<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CPL - System Architecture</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Monaco', 'Courier New', monospace;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
      color: white;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      font-size: 48px;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .subtitle {
      text-align: center;
      font-size: 18px;
      margin-bottom: 40px;
      opacity: 0.9;
    }

    .architecture-section {
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .section-title {
      font-size: 24px;
      margin-bottom: 20px;
      color: #ffd700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    pre {
      background: rgba(0, 0, 0, 0.5);
      padding: 20px;
      border-radius: 10px;
      overflow-x: auto;
      line-height: 1.6;
      font-size: 14px;
      border-left: 4px solid #4CAF50;
    }

    .flow-diagram {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .flow-box {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s;
    }

    .flow-box:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .flow-box h3 {
      color: #4CAF50;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .flow-box p {
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.9;
    }

    .event-list {
      list-style: none;
      padding: 0;
    }

    .event-list li {
      background: rgba(0, 0, 0, 0.3);
      padding: 10px 15px;
      margin: 5px 0;
      border-radius: 8px;
      border-left: 3px solid #2196F3;
    }

    .highlight {
      color: #ffd700;
      font-weight: bold;
    }

    .badge {
      display: inline-block;
      background: rgba(76, 175, 80, 0.3);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 10px;
      border: 1px solid #4CAF50;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 32px;
      }

      pre {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ CPL System Architecture</h1>
    <div class="subtitle">Class Premier League - Multiplayer Finger Cricket Game</div>

    <!-- High-Level Architecture -->
    <div class="architecture-section">
      <div class="section-title">
        1ï¸âƒ£ HIGH-LEVEL ARCHITECTURE
      </div>
      <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Web Browser        â”‚
â”‚  (index.html, lobby.html) â”‚
â”‚                           â”‚
â”‚  HTML + CSS + JavaScript  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Socket.IO (WebSocket)
              â”‚ Real-time Events
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Node.js Server      â”‚
â”‚   Express + Socket.IO     â”‚
â”‚                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚     server.js       â”‚ â”‚
â”‚ â”‚ (event handling)    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚      room.js        â”‚ â”‚
â”‚ â”‚ (rooms, teams)      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   gameLogic.js      â”‚ â”‚
â”‚ â”‚ (finger rules)      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      </pre>
    </div>

    <!-- Client-Server Flow -->
    <div class="architecture-section">
      <div class="section-title">
        2ï¸âƒ£ CLIENT-SERVER INTERACTION
      </div>
      <pre>
Player Browser
     |
     | enter name
     | click "Join Random Room"
     â–¼
Socket Event: "set-name"
Socket Event: "join-random-room"
     |
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ server.js    â”‚
â”‚               â”‚
â”‚ - create room â”‚
â”‚ - assign team â”‚
â”‚ - manage stateâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       |
       â–¼
Socket Emit: "room-update"
Socket Emit: "game-state"
       |
       â–¼
Browser updates UI
(Lobby / Game / Score / Animations)
      </pre>
    </div>

    <!-- Key Features -->
    <div class="architecture-section">
      <div class="section-title">
        3ï¸âƒ£ KEY FEATURES <span class="badge">PRODUCTION READY</span>
      </div>
      <div class="flow-diagram">
        <div class="flow-box">
          <h3>ğŸ”„ Reconnection</h3>
          <p>Players can refresh without losing their spot. 5-second grace period handles temporary disconnects.</p>
        </div>
        <div class="flow-box">
          <h3>ğŸš« Duplicate Prevention</h3>
          <p>Identity based on player name, not socket ID. Old sockets removed when player reconnects.</p>
        </div>
        <div class="flow-box">
          <h3>âš–ï¸ Team Balance</h3>
          <p>Automatic team assignment ensures fair distribution between Team A and Team B.</p>
        </div>
        <div class="flow-box">
          <h3>âœ¨ Smooth Animations</h3>
          <p>Rolling score updates, result overlays, and finger pop animations enhance UX.</p>
        </div>
        <div class="flow-box">
          <h3>ğŸ’¬ Real-time Chat</h3>
          <p>Spectators can chat during gameplay. Active players (batter/bowler) cannot chat.</p>
        </div>
        <div class="flow-box">
          <h3>ğŸ“Š Score Integrity</h3>
          <p>Server is authoritative. Score never shows NaN (defaults to 0). Client displays animations only.</p>
        </div>
      </div>
    </div>

    <!-- Socket Events -->
    <div class="architecture-section">
      <div class="section-title">
        4ï¸âƒ£ SOCKET EVENTS
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div>
          <h3 style="color: #4CAF50; margin-bottom: 15px;">Client â†’ Server</h3>
          <ul class="event-list">
            <li><span class="highlight">join-random-room</span> - Join available room</li>
            <li><span class="highlight">rejoin-room</span> - Reconnect after disconnect</li>
            <li><span class="highlight">select-leaders</span> - Choose team captains</li>
            <li><span class="highlight">start-game</span> - Begin gameplay</li>
            <li><span class="highlight">select-players</span> - Pick batter & bowler</li>
            <li><span class="highlight">player-input</span> - Submit finger choice</li>
            <li><span class="highlight">chat-message</span> - Send chat message</li>
          </ul>
        </div>
        <div>
          <h3 style="color: #2196F3; margin-bottom: 15px;">Server â†’ Client</h3>
          <ul class="event-list">
            <li><span class="highlight">room-update</span> - Team lists updated</li>
            <li><span class="highlight">game-state</span> - Score, overs, state</li>
            <li><span class="highlight">leaders-selected</span> - Captains chosen</li>
            <li><span class="highlight">players-selected</span> - Batter/bowler set</li>
            <li><span class="highlight">round-result</span> - Finger choices & outcome</li>
            <li><span class="highlight">game-over</span> - Match ended</li>
            <li><span class="highlight">chat-message</span> - Chat broadcast</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Game Flow -->
    <div class="architecture-section">
      <div class="section-title">
        5ï¸âƒ£ GAMEPLAY FLOW
      </div>
      <pre>
1. JOIN ROOM
   â†’ Player enters name
   â†’ Auto-assigned to team
   â†’ Room created/joined

2. SELECT LEADERS
   â†’ Any player can trigger
   â†’ Random selection from each team
   â†’ Leaders get special privileges

3. START GAME
   â†’ Leader clicks start
   â†’ Game state: LOBBY â†’ WAITING_PLAYERS

4. SELECT PLAYERS
   â†’ Leader picks batter (Team A)
   â†’ Leader picks bowler (Team B)
   â†’ Game state: WAITING_PLAYERS â†’ PLAYING

5. PLAY ROUND
   â†’ Batter chooses fingers (1-5)
   â†’ Bowler chooses fingers (1-5)
   â†’ If same â†’ OUT
   â†’ If different â†’ runs added
   â†’ Result animation shown

6. CONTINUE/END
   â†’ If OUT â†’ select new batter
   â†’ If overs complete â†’ GAME_OVER
   â†’ If all wickets â†’ GAME_OVER
      </pre>
    </div>

    <!-- Room Structure -->
    <div class="architecture-section">
      <div class="section-title">
        6ï¸âƒ£ ROOM DATA STRUCTURE
      </div>
      <pre>
rooms (in-memory object)
â”‚
â”œâ”€â”€ room-xyz123
â”‚    â”œâ”€â”€ id: "room-xyz123"
â”‚    â”œâ”€â”€ type: "random"
â”‚    â”œâ”€â”€ totalOvers: 5
â”‚    â”œâ”€â”€ players: [socketId1, socketId2, ...]
â”‚    â”œâ”€â”€ playerNames: {
â”‚    â”‚     socketId1: "Alice",
â”‚    â”‚     socketId2: "Bob"
â”‚    â”‚   }
â”‚    â”œâ”€â”€ teamA: [socketId1, socketId3]
â”‚    â”œâ”€â”€ teamB: [socketId2, socketId4]
â”‚    â”œâ”€â”€ leaderA: socketId1
â”‚    â”œâ”€â”€ leaderB: socketId2
â”‚    â””â”€â”€ game: {
â”‚         state: "PLAYING",
â”‚         score: 45,
â”‚         wickets: 2,
â”‚         overs: 3,
â”‚         balls: 2,
â”‚         currentBatter: socketId3,
â”‚         currentBowler: socketId4,
â”‚         batterInput: null,
â”‚         bowlerInput: null,
â”‚         battingTeam: "A",
â”‚         history: [...]
â”‚       }
â”‚
â””â”€â”€ room-abc789
     â””â”€â”€ ...
      </pre>
    </div>

    <!-- Important Rules -->
    <div class="architecture-section">
      <div class="section-title">
        7ï¸âƒ£ CRITICAL DESIGN RULES
      </div>
      <div class="flow-diagram">
        <div class="flow-box">
          <h3>ğŸ”‘ Player Identity</h3>
          <p><strong>Name-based</strong>, not socket-based. Allows seamless reconnection across sessions.</p>
        </div>
        <div class="flow-box">
          <h3>ğŸ›¡ï¸ No Duplicates</h3>
          <p>Same name in room? Old socket removed, new one attached. Single identity guaranteed.</p>
        </div>
        <div class="flow-box">
          <h3>ğŸ“ˆ Server Authority</h3>
          <p>All game logic on server. Client displays animations only. Prevents cheating.</p>
        </div>
        <div class="flow-box">
          <h3>â±ï¸ Grace Period</h3>
          <p>5-second wait before removing disconnected players. Handles page refresh smoothly.</p>
        </div>
      </div>
    </div>

  </div>

  <script>
    // Add smooth scroll
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        document.querySelector(this.getAttribute('href')).scrollIntoView({
          behavior: 'smooth'
        });
      });
    });

    // Add copy button for code blocks
    document.querySelectorAll('pre').forEach(block => {
      block.style.position = 'relative';
      const button = document.createElement('button');
      button.textContent = 'ğŸ“‹ Copy';
      button.style.position = 'absolute';
      button.style.top = '10px';
      button.style.right = '10px';
      button.style.background = 'rgba(76, 175, 80, 0.8)';
      button.style.color = 'white';
      button.style.border = 'none';
      button.style.padding = '5px 10px';
      button.style.borderRadius = '5px';
      button.style.cursor = 'pointer';
      button.style.fontSize = '12px';
      
      button.addEventListener('click', () => {
        navigator.clipboard.writeText(block.textContent);
        button.textContent = 'âœ… Copied!';
        setTimeout(() => {
          button.textContent = 'ğŸ“‹ Copy';
        }, 2000);
      });
      
      block.appendChild(button);
    });
  </script>
</body>
</html>
